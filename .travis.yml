language: c

# container boots up faster than legacy; problem is no sudo
sudo: false

matrix:
  include:
   - env: RUN=1 SUFFIX=gz
     os: linux
   - env: RUN=2 SUFFIX=gz
     os: linux
   - env: RUN=3 SUFFIX=gz
     os: linux
   - env: RUN=4 SUFFIX=gz
     os: linux

# Can't use apt plugin because dyn/prof GHC are not whitelisted
# Also, download from Haskell website much faster than Launchpad
# Can't download deb and install manually because dpkg --force-no-root does not work
# bz2/xz comparison: xz 0.81s download, 10.85s unpack
#                    bz2 0.64s download, 33.60s 28.71s unpack!!
#
# xz 0.46 10.38 1.44 11.79
# xz 0.43 10.12 3.12 13.02
# xz 0.33 9.56 1.36 11.23
# xz 1.22 11.43 2.39 14.38
# bz2 0.67 29.01 2.37 10.91
# bz2 0.93 30.03 1.51 13.27
# bz2 0.67 26.03 1.24 10.96
# bz2 0.63 31.19 2.20 11.15
#
# Clearly xz is superior
#
# In comparison using legacy container with sudo seems to take 42s (so
# this is x2 improvement).
# Maybe possibility to cache what we unpack here too.
#
# Since download speed is REALLY fast off downloads.haskell.org, you
# might wonder if gzip is also fast.  Unfortunately I don't have
# access to server with as fast a pipe as downloads.haskell.org
#

before_install:
 - mkdir $HOME/usr
 - wget http://hs01.scs.stanford.edu/ghc-7.10.3b-x86_64-deb7-linux.tar.gz
 - tar xf ghc-7.10.3b-x86_64-deb7-linux.tar.gz
   # - wget http://downloads.haskell.org/~ghc/7.10.3/ghc-7.10.3b-i386-deb7-linux.tar.xz
   # - tar xf ghc-7.10.3b-x86_64-deb7-linux.tar.xz
 - cd ghc-7.10.3
 - ./configure --prefix=$HOME/usr
 - make install
 - export PATH=$HOME/usr/bin:$PATH

script:
 - ghc --version

notifications:
  irc:
    channels:
      - "chat.freenode.net##haskell-cabal"
  slack: haskell-cabal:sCq6GLfy9N8MJrInosg871n4
